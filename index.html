<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DSU Marks Card Flow</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    .hidden {
      display: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table,
    th,
    td {
      border: 1px solid #000;
    }
    th,
    td {
      text-align: center;
      padding: 8px;
    }
    th {
      background-color: #f2f2f2;
    }
    input[type="text"],
    input[type="number"],
    select {
      margin-bottom: 10px;
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      font-size: 1rem;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
    }
    .error {
      color: red;
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- PAGE 1 -->
  <div id="page1">
    <h2>Student Details</h2>
    <label for="studentName">Name *</label>
    <input type="text" id="studentName" required />
    <label for="studentUSN">USN * <small>(Format: ENG24XX0000)</small></label>
    <input
      type="text"
      id="studentUSN"
      maxlength="11"
      placeholder="ENG24AM0306"
      required
      style="text-transform: uppercase"
    />
    <label for="studentBranch">Branch *</label>
    <select id="studentBranch" required>
      <option value="" disabled selected>Select branch</option>
      <option value="CSE AI&ML">CSE AI&ML</option>
      <option value="CSE AI & Robotics">CSE AI & Robotics</option>
      <option value="CSE AI & DS">CSE AI & DS</option>
      <option value="CSE Cyber Security">CSE Cyber Security</option>
      <option value="Mechanical">Mechanical</option>
      <option value="Electrical">Electrical</option>
      <option value="CSE CORE">CSE CORE</option>
    </select>
    <div id="page1Error" class="error"></div>
    <button onclick="goToPage2()">Next</button>
  </div>

  <div id="page2" class="hidden">
    <h2>Enter Marks</h2>
    <form id="marksForm">
      <table>
        <thead>
          <tr>
            <th>Course</th>
            <th>MSE 1 (out of 100)</th>
            <th>MSE 2 (out of 100)</th>
            <th>IA (max varies)</th>
            <th>SEE (out of 100)</th>
          </tr>
        </thead>
        <tbody id="inputRows"></tbody>
      </table>
      <div id="page2Error" class="error"></div>
      <button type="button" onclick="goToPage3()">Calculate & Show Result</button>
      <button type="button" onclick="backToPage1()" style="margin-left: 12px;">Back</button>
    </form>
  </div>

  <div id="page3" class="hidden">
    <h2>Results for <span id="displayName"></span> (<span id="displayUSN"></span>)</h2>
    <div id="result"></div>
    <button onclick="backToPage2()">Back</button>
  </div>

</div>

<script>
  const courses = [
    { name: "CHEM", credits: 3, iaMax: 30, mseWeight: 0.375 },
    { name: "IME", credits: 3, iaMax: 30, mseWeight: 0.375 },
    { name: "EE", credits: 2, iaMax: 20, mseWeight: 0.5 },
    { name: "EM", credits: 2, iaMax: 20, mseWeight: 0.5 },
    { name: "SMC", credits: 3, iaMax: 20, mseWeight: "avg" }, // special case
    { name: "CPPS", credits: 4, iaMax: 30, mseWeight: 0.375 },
    { name: "ENG", credits: 2, iaMax: 100, mseWeight: 0, iaOnly: true },
    { name: "CIA", credits: 2, iaMax: 50, mseWeight: 0, iaOnly: true }
  ];

  function createInputRow(course) {
    return `
      <tr>
        <td>${course.name}</td>
        <td><input type="number" min="0" max="100" step="0.01" id="${course.name}_mse1" required ${course.iaOnly ? 'disabled' : ''}></td>
        <td><input type="number" min="0" max="100" step="0.01" id="${course.name}_mse2" required ${course.iaOnly ? 'disabled' : ''}></td>
        <td><input type="number" min="0" max="${course.iaMax}" step="0.01" id="${course.name}_ia" required></td>
        <td><input type="number" min="0" max="100" step="0.01" id="${course.name}_see" required ${course.iaOnly ? 'disabled' : ''}></td>
      </tr>
    `;
  }

  // Initialize page 2 input rows
  function initPage2() {
    const tbody = document.getElementById("inputRows");
    tbody.innerHTML = courses.map(createInputRow).join("");
  }

  function goToPage2() {
    const name = document.getElementById("studentName").value.trim();
    const usn = document.getElementById("studentUSN").value.trim();
    const errorDiv = document.getElementById("page1Error");
    if (!name) {
      errorDiv.textContent = "Name is required.";
      return;
    }
    if (!usn) {
      errorDiv.textContent = "USN is required.";
      return;
    }
    errorDiv.textContent = "";

    initPage2();
    document.getElementById("page1").classList.add("hidden");
    document.getElementById("page2").classList.remove("hidden");
  }

  function backToPage1() {
    document.getElementById("page2").classList.add("hidden");
    document.getElementById("page1").classList.remove("hidden");
  }

  function backToPage2() {
    document.getElementById("page3").classList.add("hidden");
    document.getElementById("page2").classList.remove("hidden");
  }

  function GPoints(marks) {
    if (marks >= 90) return {gp:10, grade:"O"};
    if (marks >= 80) return {gp:9, grade:"A+"};
    if (marks >= 70) return {gp:8, grade:"A"};
    if (marks >= 60) return {gp:7, grade:"B+"};
    if (marks >= 50) return {gp:6, grade:"B"};
    if (marks >= 45) return {gp:5, grade:"C"};
    if (marks >= 40) return {gp:4, grade:"P"};
    return {gp:0, grade:"F"};
  }

  function goToPage3() {
    // Validate inputs
    const errorDiv = document.getElementById("page2Error");
    errorDiv.textContent = "";
    for (const c of courses) {
      if (!c.iaOnly) {
        const mse1 = document.getElementById(`${c.name}_mse1`).value;
        const mse2 = document.getElementById(`${c.name}_mse2`).value;
        const see = document.getElementById(`${c.name}_see`).value;
        if (mse1 === "" || mse2 === "" || see === "") {
          errorDiv.textContent = `Please fill all MSE1, MSE2, and SEE for ${c.name}`;
          return;
        }
      }
      const ia = document.getElementById(`${c.name}_ia`).value;
      if (ia === "") {
        errorDiv.textContent = `Please fill IA for ${c.name}`;
        return;
      }
    }

    // All good, calculate and show result
    const name = document.getElementById("studentName").value.trim();
    const usn = document.getElementById("studentUSN").value.trim();

    let output = `<table><thead><tr>
      <th>Course</th><th>MSE 1</th><th>MSE 2</th><th>MSE Avg</th><th>IA</th><th>SEE</th><th>Grand Total (GT)</th><th>Grade Point</th><th>Grade</th><th>Credits</th><th>Credit Points</th>
    </tr></thead><tbody>`;

    let totalCreditPoints = 0;
    let totalCredits = 0;

    for(const course of courses) {
      const mse1 = course.iaOnly ? 0 : parseFloat(document.getElementById(`${course.name}_mse1`).value);
      const mse2 = course.iaOnly ? 0 : parseFloat(document.getElementById(`${course.name}_mse2`).value);
      const ia = parseFloat(document.getElementById(`${course.name}_ia`).value);
      const see = course.iaOnly ? 0 : parseFloat(document.getElementById(`${course.name}_see`).value);

      // Calculate MSE Avg
      let mseavg = 0;
      if(course.iaOnly){
        mseavg = 0;
      } else if(course.name === "SMC"){
        mseavg = (mse1 + mse2) / 2;
      } else {
        mseavg = (mse1 + mse2) * course.mseWeight;
      }

      // Calculate Grand Total (GT)
      let GT = 0;
      if(course.iaOnly){
        GT = ia; // IA only
      } else {
        GT = ia + mseavg + (see * 0.4);
      }

      const {gp, grade} = GPoints(GT);
      const creditPoints = gp * course.credits;
      totalCreditPoints += creditPoints;
      totalCredits += course.credits;

      output += `<tr>
        <td>${course.name}</td>
        <td>${course.iaOnly ? "-" : mse1.toFixed(2)}</td>
        <td>${course.iaOnly ? "-" : mse2.toFixed(2)}</td>
        <td>${mseavg.toFixed(2)}</td>
        <td>${ia.toFixed(2)}</td>
        <td>${course.iaOnly ? "-" : see.toFixed(2)}</td>
        <td>${GT.toFixed(2)}</td>
        <td>${gp}</td>
        <td>${grade}</td>
        <td>${course.credits}</td>
        <td>${creditPoints.toFixed(2)}</td>
      </tr>`;
    }

    output += `<tr>
      <td colspan="9" style="text-align:right"><strong>Total</strong></td>
      <td><strong>${totalCredits}</strong></td>
      <td><strong>${totalCreditPoints.toFixed(2)}</strong></td>
    </tr></tbody></table>`;

    document.getElementById("displayName").textContent = name;
    document.getElementById("displayUSN").textContent = usn;
    document.getElementById("result").innerHTML = output;

    document.getElementById("page2").classList.add("hidden");
    document.getElementById("page3").classList.remove("hidden");
  }
</script>

</body>
</html>
