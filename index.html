<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DSU Marks Card Flow</title>
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #3498db;
      --accent-color: #e74c3c;
      --light-color: #ecf0f1;
      --success-color: #27ae60;
      --warning-color: #f39c12;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }
    .hidden {
      display: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      box-shadow: 0 2px 3px rgba(0,0,0,0.1);
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      text-align: center;
      padding: 10px;
    }
    th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 500;
    }
    tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    tr:hover {
      background-color: #f1f1f1;
    }
    
    input[type="text"],
    input[type="number"],
    select {
      margin-bottom: 10px;
      width: 100%;
      padding: 10px;
      box-sizing: border-box;
      font-size: 1rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      transition: border 0.3s;
    }
    
    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
      border-color: var(--secondary-color);
      outline: none;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }
    
    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
      color: var(--primary-color);
    }
    
    button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      transition: all 0.3s;
      font-weight: 500;
    }
    
    .btn-primary {
      background-color: var(--secondary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #2980b9;
    }
    
    .btn-secondary {
      background-color: #95a5a6;
      color: white;
    }
    
    .btn-secondary:hover {
      background-color: #7f8c8d;
    }
    
    .error {
      color: var(--accent-color);
      margin-top: 10px;
      font-weight: bold;
      padding: 10px;
      background-color: #fadbd8;
      border-radius: 4px;
      border-left: 4px solid var(--accent-color);
    }
    
    .success {
      color: var(--success-color);
      margin-top: 10px;
      font-weight: bold;
    }
    
    /* Page specific styles */
    #page1 {
      background-color: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    #page1 h2 {
      color: var(--primary-color);
      border-bottom: 2px solid var(--secondary-color);
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    
    #page2 {
      background-color: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    #page2 h2 {
      color: var(--primary-color);
      border-bottom: 2px solid var(--secondary-color);
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    
    #page3 {
      background-color: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    #page3 h2 {
      color: var(--primary-color);
      border-bottom: 2px solid var(--secondary-color);
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    
    /* Grade colors */
    .grade-O { color: #27ae60; font-weight: bold; }
    .grade-Aplus { color: #2ecc71; font-weight: bold; }
    .grade-A { color: #3498db; font-weight: bold; }
    .grade-Bplus { color: #f39c12; font-weight: bold; }
    .grade-B { color: #e67e22; font-weight: bold; }
    .grade-C { color: #d35400; font-weight: bold; }
    .grade-P { color: #34495e; font-weight: bold; }
    .grade-F { color: #e74c3c; font-weight: bold; }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      table {
        font-size: 0.9rem;
      }
      
      th, td {
        padding: 6px;
      }
    }
    
    /* Tooltip for USN */
    small {
      color: #7f8c8d;
      font-size: 0.8rem;
      font-weight: normal;
    }
    
    /* Highlight totals */
    tr:last-child {
      background-color: #e8f4f8 !important;
      font-weight: bold;
    }
    
    tr:last-child:hover {
      background-color: #d4e6f1 !important;
    }
  </style>
</head>
<body>
  <!-- PAGE 1 -->
  <div id="page1">
    <h2>Student Details</h2>
    <label for="studentName">Name *</label>
    <input type="text" id="studentName" required />
    <label for="studentUSN">USN * <small>(Format: ENG24XX0000)</small></label>
    <input
      type="text"
      id="studentUSN"
      maxlength="11"
      placeholder="ENG24AM0306"
      required
      style="text-transform: uppercase"
    />
    <label for="studentBranch">Branch *</label>
    <select id="studentBranch" required>
      <option value="" disabled selected>Select branch</option>
      <option value="CSE AI&ML">CSE AI&ML</option>
      <option value="CSE AI & Robotics">CSE AI & Robotics</option>
      <option value="CSE AI & DS">CSE AI & DS</option>
      <option value="CSE Cyber Security">CSE Cyber Security</option>
      <option value="Mechanical">Mechanical</option>
      <option value="Electrical">Electrical</option>
      <option value="CSE CORE">CSE CORE</option>
    </select>
    <div id="page1Error" class="error"></div>
    <button class="btn-primary" onclick="goToPage2()">Next</button>
  </div>

  <div id="page2" class="hidden">
    <h2>Enter Marks</h2>
    <form id="marksForm">
      <table>
        <thead>
          <tr>
            <th>Course</th>
            <th>MSE 1 (out of 40)</th>
            <th>MSE 2 (out of 40)</th>
            <th>IA (max varies)</th>
            <th>SEE (out of 100)</th>
          </tr>
        </thead>
        <tbody id="inputRows"></tbody>
      </table>
      <div id="page2Error" class="error"></div>
      <button type="button" class="btn-primary" onclick="goToPage3()">Calculate & Show Result</button>
      <button type="button" class="btn-secondary" onclick="backToPage1()" style="margin-left: 12px;">Back</button>
    </form>
  </div>

  <div id="page3" class="hidden">
    <h2>Results for <span id="displayName"></span> (<span id="displayUSN"></span>)</h2>
    <div id="result"></div>
    <button class="btn-secondary" onclick="backToPage2()">Back</button>
  </div>

</div>

<script>
  const courses = [
    { name: "CHEM", credits: 3, iaMax: 30, mseWeight: 0.375 },
    { name: "IME", credits: 3, iaMax: 30, mseWeight: 0.375 },
    { name: "EE", credits: 2, iaMax: 20, mseWeight: 0.5 },
    { name: "EM", credits: 2, iaMax: 20, mseWeight: 0.5 },
    { name: "SMC", credits: 3, iaMax: 20, mseWeight: "avg" }, // special case
    { name: "CPPS", credits: 4, iaMax: 30, mseWeight: 0.375 },
    { name: "ENG", credits: 2, iaMax: 100, mseWeight: 0, iaOnly: true },
    { name: "CIA", credits: 2, iaMax: 100, mseWeight: 0, iaOnly: true }
  ];

  // Store current values when navigating to page 3
  let currentValues = {};

  function createInputRow(course) {
    // Check if we have stored values for this course
    const storedValues = currentValues[course.name] || {};
    
    return `
      <tr>
        <td>${course.name}</td>
        <td><input type="number" min="0" max="${course.iaOnly ? 0 : 40}" step="0.01" 
            id="${course.name}_mse1" required ${course.iaOnly ? 'disabled' : ''}
            value="${storedValues.mse1 || ''}"></td>
        <td><input type="number" min="0" max="${course.iaOnly ? 0 : 40}" step="0.01" 
            id="${course.name}_mse2" required ${course.iaOnly ? 'disabled' : ''}
            value="${storedValues.mse2 || ''}"></td>
        <td><input type="number" min="0" max="${course.iaMax}" step="0.01" 
            id="${course.name}_ia" required
            value="${storedValues.ia || ''}"></td>
        <td><input type="number" min="0" max="100" step="0.01" 
            id="${course.name}_see" required ${course.iaOnly ? 'disabled' : ''}
            value="${storedValues.see || ''}"></td>
      </tr>
    `;
  }

  // Initialize page 2 input rows
  function initPage2() {
    const tbody = document.getElementById("inputRows");
    tbody.innerHTML = courses.map(createInputRow).join("");
  }

  function validateUSN(usn) {
    // USN format: ENG24XX0000 (11 characters)
    const usnPattern = /^ENG24[A-Z]{2}\d{4}$/;
    return usnPattern.test(usn);
  }

  function goToPage2() {
    const name = document.getElementById("studentName").value.trim();
    const usn = document.getElementById("studentUSN").value.trim().toUpperCase();
    const errorDiv = document.getElementById("page1Error");
    if (!name) {
      errorDiv.textContent = "Name is required.";
      return;
    }
    if (!usn) {
      errorDiv.textContent = "USN is required.";
      return;
    }
    if (!validateUSN(usn)) {
      errorDiv.textContent = "USN must be in format ENG24XX0000 (first 5 fixed, next 2 letters, last 4 digits)";
      return;
    }
    errorDiv.textContent = "";

    initPage2();
    document.getElementById("page1").classList.add("hidden");
    document.getElementById("page2").classList.remove("hidden");
  }

  function backToPage1() {
    document.getElementById("page2").classList.add("hidden");
    document.getElementById("page1").classList.remove("hidden");
  }

  function backToPage2() {
    document.getElementById("page3").classList.add("hidden");
    document.getElementById("page2").classList.remove("hidden");
  }

  function GPoints(marks) {
    if (marks >= 90) return {gp:10, grade:"O", class: "grade-O"};
    if (marks >= 80) return {gp:9, grade:"A+", class: "grade-Aplus"};
    if (marks >= 70) return {gp:8, grade:"A", class: "grade-A"};
    if (marks >= 60) return {gp:7, grade:"B+", class: "grade-Bplus"};
    if (marks >= 50) return {gp:6, grade:"B", class: "grade-B"};
    if (marks >= 45) return {gp:5, grade:"C", class: "grade-C"};
    if (marks >= 40) return {gp:4, grade:"P", class: "grade-P"};
    return {gp:0, grade:"F", class: "grade-F"};
  }

  function goToPage3() {
    // Store all current values before validation
    currentValues = {};
    for (const c of courses) {
      currentValues[c.name] = {
        mse1: document.getElementById(`${c.name}_mse1`).value,
        mse2: document.getElementById(`${c.name}_mse2`).value,
        ia: document.getElementById(`${c.name}_ia`).value,
        see: document.getElementById(`${c.name}_see`).value
      };
    }

    // Validate inputs
    const errorDiv = document.getElementById("page2Error");
    errorDiv.textContent = "";
    for (const c of courses) {
      if (!c.iaOnly) {
        const mse1 = document.getElementById(`${c.name}_mse1`).value;
        const mse2 = document.getElementById(`${c.name}_mse2`).value;
        const see = document.getElementById(`${c.name}_see`).value;
        
        if (mse1 === "" || mse2 === "" || see === "") {
          errorDiv.textContent = `Please fill all MSE1, MSE2, and SEE for ${c.name}`;
          return;
        }
        if (parseFloat(mse1) > 40 || parseFloat(mse2) > 40) {
          errorDiv.textContent = `MSE marks for ${c.name} cannot exceed 40`;
          return;
        }
        if (parseFloat(see) > 100) {
          errorDiv.textContent = `SEE marks for ${c.name} cannot exceed 100`;
          return;
        }
      }
      const ia = document.getElementById(`${c.name}_ia`).value;
      if (ia === "") {
        errorDiv.textContent = `Please fill IA for ${c.name}`;
        return;
      }
      if (parseFloat(ia) > c.iaMax) {
        errorDiv.textContent = `IA marks for ${c.name} cannot exceed ${c.iaMax}`;
        return;
      }
    }

    // All good, calculate and show result
    const name = document.getElementById("studentName").value.trim();
    const usn = document.getElementById("studentUSN").value.trim();

    let output = `<table><thead><tr>
      <th>Course</th><th>MSE 1</th><th>MSE 2</th><th>MSE Avg</th><th>IA</th><th>SEE</th><th>Grand Total (GT)</th><th>Grade Point</th><th>Grade</th><th>Credits</th><th>Credit Points</th>
    </tr></thead><tbody>`;

    let totalCreditPoints = 0;
    let totalCredits = 0;

    for(const course of courses) {
      const mse1 = course.iaOnly ? 0 : parseFloat(document.getElementById(`${course.name}_mse1`).value);
      const mse2 = course.iaOnly ? 0 : parseFloat(document.getElementById(`${course.name}_mse2`).value);
      const ia = parseFloat(document.getElementById(`${course.name}_ia`).value);
      const see = course.iaOnly ? 0 : parseFloat(document.getElementById(`${course.name}_see`).value);

      // Calculate MSE Avg
      let mseavg = 0;
      if(course.iaOnly){
        mseavg = 0;
      } else if(course.name === "SMC"){
        mseavg = (mse1 + mse2) / 2;
      } else {
        mseavg = (mse1 + mse2) * course.mseWeight;
      }

      // Calculate Grand Total (GT)
      let GT = 0;
      if(course.iaOnly){
        GT = ia; // IA only
      } else {
        GT = ia + mseavg + (see * 0.4);
      }

      const {gp, grade, class: gradeClass} = GPoints(GT);
      const creditPoints = gp * course.credits;
      totalCreditPoints += creditPoints;
      totalCredits += course.credits;

      output += `<tr>
        <td>${course.name}</td>
        <td>${course.iaOnly ? "-" : mse1.toFixed(2)}</td>
        <td>${course.iaOnly ? "-" : mse2.toFixed(2)}</td>
        <td>${mseavg.toFixed(2)}</td>
        <td>${ia.toFixed(2)}</td>
        <td>${course.iaOnly ? "-" : see.toFixed(2)}</td>
        <td>${GT.toFixed(2)}</td>
        <td>${gp}</td>
        <td class="${gradeClass}">${grade}</td>
        <td>${course.credits}</td>
        <td>${creditPoints.toFixed(2)}</td>
      </tr>`;
    }

    const sgpa = (totalCreditPoints / totalCredits).toFixed(2);
    
    output += `<tr>
      <td colspan="9" style="text-align:right"><strong>Total</strong></td>
      <td><strong>${totalCredits}</strong></td>
      <td><strong>${totalCreditPoints.toFixed(2)}</strong></td>
    </tr>
    <tr style="background-color: #e8f8f5 !important;">
      <td colspan="10" style="text-align:right"><strong>SGPA</strong></td>
      <td><strong>${sgpa}</strong></td>
    </tr>
    
</tbody></table>
  <div style="margin-top: 20px;">
    <label for="sem1SGPA"><strong>Enter your 1st Semester SGPA:</strong></label>
    <input type="number" id="sem1SGPA" min="0" max="10" step="0.01" style="width: 200px; display: inline-block; margin-left: 10px;" />
    <button class="btn-primary" onclick="calculateCGPA()" style="margin-left: 12px;">Calculate CGPA</button>
    <div id="cgpaOutput" style="margin-top: 10px; font-weight: bold;"></div>
  </div>
`;

    document.getElementById("displayName").textContent = name;
    document.getElementById("displayUSN").textContent = usn;
    document.getElementById("result").innerHTML = output;

    document.getElementById("page2").classList.add("hidden");
    document.getElementById("page3").classList.remove("hidden");
  }

function calculateCGPA() {
  const sem1 = parseFloat(document.getElementById("sem1SGPA").value);
  const sem2 = parseFloat(document.querySelector("#result table tr:last-child td:last-child").textContent);
  const cgpaDiv = document.getElementById("cgpaOutput");

  if (isNaN(sem1) || sem1 < 0 || sem1 > 10) {
    cgpaDiv.textContent = "Please enter a valid SGPA between 0 and 10.";
    cgpaDiv.style.color = "var(--accent-color)";
    return;
  }

  const avg = ((sem1 + sem2) / 2).toFixed(2);
  cgpaDiv.textContent = `CGPA = ${avg}`;
  cgpaDiv.style.color = "var(--primary-color)";
}
</script>

</body>
</html>